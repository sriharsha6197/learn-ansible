- name: print free memory
  hosts: localhost
  become: yes
  tasks:
    - name: get memory status
      ansible.builtin.shell: free | grep Mem | xargs
      register: Free
    - name: store details of memory
      ansible.builtin.set_fact:
        FREE: "{{ Free.stdout | split(' ') }}"
    - name: print mem status
      ansible.builtin.debug:
        msg: "{{ FREE }}"
    - name: store total, used, free memory available
      ansible.builtin.set_fact:
        TOTAL: "{{ FREE[1] | int }}"
        USED: "{{ FREE[2] | int }}"
        FREE: "{{ FREE[3] | int }}"

    - name: print available memory
      ansible.builtin.debug:
        msg: "{{ TOTAL - USED }}"

    # - name: get used memory status
    #   ansible.builtin.shell: free | grep Mem | awk '{print$3}'
    #   register: used
    # - name: print used memory
    #   ansible.builtin.debug:
    #     msg: "{{ used.stdout }}"
    # - name: print free memory status
    #   ansible.builtin.debug:
    #     msg: "{{ total - used }}"